{% extends "base_generic.html" %}

{% block content %}
  <h1>USWDS scanner</h1>
  <p>The <a href="https://designsystem.digital.gov/">U.S. Web Design System (USWDS)</a> is a design system for U.S. government websites that makes it easier to build accessible, mobile-friendly sites. The USWDS scanner checks each domain for the presence and version of USWDS code. The scanner looks for specific code in the domain's CSS and HTML files, which fonts are in use, and other USWDS indicators.</p>

  <p>The USWDS scanner results are based on an analysis count. The analysis count is a count of the number of USWDS-related indicators. The scanner will search for sites that have an analysis count greater than or equal to the number entered. More details about the USWDS analysis count is available in the <a href="https://github.com/18F/domain-scan/blob/tspencer/200scanner/scanners/uswds2.py#L35-L143">domain-scan codebase</a>.
    </p>

  <form action="{% url 'searchUSWDS' %}" method="get">
    Analysis Count Filter:
  	{% if query == None %}
    <input name="q" type="text" placeholder="Search Here">
    {% else %}
    <input name="q" type="text" value="{{ query }}">
    {% endif %}
    <select name="sort" onchange="this.form.submit()">
      {% for sort in sortinglist %}
        {% if selected_sort == sort %}
      <option value="{{ sort }}" selected>Sort by {{ sort }}</option>
        {% else %}
      <option value="{{ sort }}">Sort by {{ sort }}</option>
        {% endif %}
      {% endfor %}
    </select>
    <select name="version" onchange="this.form.submit()">
      {% for version in versions %}
        {% if selected_version == version %}
      <option value="{{ version }}" selected>{{ version }}</option>
        {% else %}
      <option value="{{ version }}">{{ version }}</option>
        {% endif %}
      {% endfor %}
    </select>
    <select name="date" onchange="this.form.submit()">
    	{% for date in dates %}
    		{% if selected_date == date %}
    	<option value="{{ date }}" selected>{{ date }}</option>
    		{% else %}
    	<option value="{{ date }}">{{ date }}</option>
    		{% endif %}
    	{% endfor %}
    </select>
    <select name="agency" onchange="this.form.submit()">
      {% for agency in agencies %}
        {% if selected_agency == agency %}
      <option value="{{ agency }}" selected>{{ agency }}</option>
        {% else %}
      <option value="{{ agency }}">{{ agency }}</option>
        {% endif %}
      {% endfor %}
    </select>
    <select name="domaintype" onchange="this.form.submit()">
      {% for domaintype in domaintypes %}
        {% if selected_domaintype == domaintype %}
      <option value="{{ domaintype }}" selected>{{ domaintype }}</option>
        {% else %}
      <option value="{{ domaintype }}">{{ domaintype }}</option>
        {% endif %}
      {% endfor %}
    </select>

  <h2>Scan Results:</h2>
    <a href="{% url 'searchUSWDSjson' %}?date={{selected_date | urlencode}}&version={{selected_version | urlencode}}&q={{query | urlencode}}&agency={{selected_agency | urlencode}}&domaintype={{selected_domaintype | urlencode}}">JSON Export</a>

    <a href="{% url 'searchUSWDScsv' %}?date={{selected_date | urlencode}}&version={{selected_version | urlencode}}&q={{query | urlencode}}&agency={{selected_agency | urlencode}}&domaintype={{selected_domaintype | urlencode}}">CSV Export</a>

    <div class="pagination">
    <p>Hits Per Page:
    <select name="hitsperpage" onchange="this.form.submit()" style="width: 100px;">
      {% for hits in hitsperpagelist %}
        {% if selected_hitsperpage == hits %}
          <option value="{{ hits }}" selected>{{ hits }}</option>
        {% else %}
          <option value="{{ hits }}">{{ hits }}</option>
        {% endif %}
      {% endfor %}
    </select></p>
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="{% url 'searchUSWDS' %}?date={{selected_date | urlencode}}&page=1&version={{selected_version | urlencode}}&q={{query | urlencode}}&agency={{selected_agency | urlencode}}&domaintype={{selected_domaintype | urlencode}}">&laquo; First</a>
            <a href="{% url 'searchUSWDS' %}?date={{selected_date | urlencode}}&page={{page_obj.previous_page_number}}&version={{selected_version | urlencode}}&q={{query | urlencode}}&agency={{selected_agency | urlencode}}">Previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="{% url 'searchUSWDS' %}?date={{selected_date| urlencode}}&page={{page_obj.next_page_number}}&version={{selected_version | urlencode}}&q={{query | urlencode}}&agency={{selected_agency | urlencode}}&domaintype={{selected_domaintype | urlencode}}">Next</a>
            <a href="{% url 'searchUSWDS' %}?date={{selected_date | urlencode}}&page={{page_obj.paginator.num_pages}}&version={{selected_version | urlencode}}&q={{query | urlencode}}&agency={{selected_agency | urlencode}}&domaintype={{selected_domaintype | urlencode}}">Last &raquo;</a>
        {% endif %}
    </span>
  </div>
  </form>

  <table>
    <tr>
      <th>Domain</th>
      <th>Analysis</th>
      <th>USWDS Version</th>
      <th>Agency</th>
      <th>Organization</th>
      <th>Branch</th>
      <th>Analysis Details</th>
    </tr>
  	{% for scan in search_results %}
    <tr>
      <td><strong><a href="https://{{ scan.domain }}">{{ scan.domain }}</a>:</strong></td>
      <td>{{scan.data.total_score}}</td>
      <td>{{scan.data.uswdsversion}}</td>
      <td>{{ scan.agency }}</td>
      <td>{{ scan.organization }}</td>
      <td>{{scan.domaintype}}</td>
      <td><a href="{% url 'scan' scan.scantype scan.domain %}">{% url 'scan' scan.scantype scan.domain %}</a></td>
    </tr>
    {% endfor %}
  </table>

    <div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="{% url 'searchUSWDS' %}?date={{selected_date | urlencode}}&page=1&version={{selected_version | urlencode}}&q={{query | urlencode}}&agency={{selected_agency | urlencode}}&domaintype={{selected_domaintype | urlencode}}">&laquo; First</a>
            <a href="{% url 'searchUSWDS' %}?date={{selected_date | urlencode}}&page={{page_obj.previous_page_number}}&version={{selected_version | urlencode}}&q={{query | urlencode}}&agency={{selected_agency | urlencode}}">Previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="{% url 'searchUSWDS' %}?date={{selected_date| urlencode}}&page={{page_obj.next_page_number}}&version={{selected_version | urlencode}}&q={{query | urlencode}}&agency={{selected_agency | urlencode}}&domaintype={{selected_domaintype | urlencode}}">Next</a>
            <a href="{% url 'searchUSWDS' %}?date={{selected_date | urlencode}}&page={{page_obj.paginator.num_pages}}&version={{selected_version | urlencode}}&q={{query | urlencode}}&agency={{selected_agency | urlencode}}&domaintype={{selected_domaintype | urlencode}}">Last &raquo;</a>
        {% endif %}
    </span>
  </div>

{% endblock %}
